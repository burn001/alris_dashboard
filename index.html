<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALRIS ÏÇ¨Ïö©Îüâ ÎåÄÏãúÎ≥¥Îìú</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        /* ALRIS Design System - Matching alris-v1 */
        :root {
            --background: 0 0% 98%;
            --beige: 45 20% 96%;
            --foreground: 220 13% 18%;
            --card: 0 0% 100%;
            --card-foreground: 220 13% 18%;
            --primary: 197 37% 24%;
            --primary-foreground: 0 0% 98%;
            --primary-glow: 197 37% 34%;
            --secondary: 220 14% 96%;
            --secondary-foreground: 220 13% 18%;
            --muted: 220 14% 96%;
            --muted-foreground: 220 9% 46%;
            --accent: 220 14% 96%;
            --accent-foreground: 197 37% 24%;
            --destructive: 0 84% 60%;
            --border: 220 13% 91%;
            --radius: 0.5rem;
            --shadow-sm: 0 1px 2px 0 hsl(220 13% 18% / 0.05);
            --shadow-md: 0 4px 6px -1px hsl(220 13% 18% / 0.1), 0 2px 4px -1px hsl(220 13% 18% / 0.06);
            --shadow-lg: 0 10px 15px -3px hsl(220 13% 18% / 0.1), 0 4px 6px -2px hsl(220 13% 18% / 0.05);
        }

        .dark {
            --background: 220 13% 6%;
            --beige: 220 13% 12%;
            --foreground: 210 40% 98%;
            --card: 220 13% 8%;
            --card-foreground: 210 40% 98%;
            --primary: 197 50% 45%;
            --primary-foreground: 220 13% 6%;
            --primary-glow: 197 50% 55%;
            --secondary: 220 13% 15%;
            --secondary-foreground: 210 40% 98%;
            --muted: 220 13% 15%;
            --muted-foreground: 215 20% 65%;
            --accent: 220 13% 15%;
            --accent-foreground: 197 50% 45%;
            --border: 220 13% 18%;
            --shadow-sm: 0 1px 2px 0 hsl(0 0% 0% / 0.2);
            --shadow-md: 0 4px 6px -1px hsl(0 0% 0% / 0.3), 0 2px 4px -1px hsl(0 0% 0% / 0.2);
            --shadow-lg: 0 10px 15px -3px hsl(0 0% 0% / 0.3), 0 4px 6px -2px hsl(0 0% 0% / 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Nanum Gothic', 'Inter', system-ui, sans-serif;
            background: hsl(var(--background));
            min-height: 100vh;
            color: hsl(var(--foreground));
            padding: 24px;
            font-weight: 500;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 700;
            color: hsl(var(--primary));
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1 .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--primary-glow)));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .theme-toggle {
            background: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            border-radius: var(--radius);
            padding: 10px 16px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            color: hsl(var(--foreground));
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle:hover {
            box-shadow: var(--shadow-md);
            border-color: hsl(var(--primary));
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: hsl(var(--card));
            border-radius: calc(var(--radius) * 2);
            padding: 24px;
            border: 1px solid hsl(var(--border));
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-card .label { 
            font-size: 0.875rem; 
            color: hsl(var(--muted-foreground)); 
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-card .value { 
            font-size: 2.25rem; 
            font-weight: 700;
            color: hsl(var(--primary));
        }

        .stat-card.v2 .value {
            color: hsl(var(--destructive));
        }

        .stat-card .trend {
            font-size: 0.75rem;
            color: hsl(var(--muted-foreground));
            margin-top: 8px;
        }

        /* Chart Container */
        .chart-container {
            background: hsl(var(--card));
            border-radius: calc(var(--radius) * 2);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid hsl(var(--border));
            box-shadow: var(--shadow-sm);
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: hsl(var(--foreground));
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-wrapper { 
            height: 320px; 
        }

        /* Tables */
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
        }

        .table-container {
            background: hsl(var(--card));
            border-radius: calc(var(--radius) * 2);
            padding: 24px;
            border: 1px solid hsl(var(--border));
            box-shadow: var(--shadow-sm);
            max-height: 420px;
            overflow-y: auto;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
        }

        th, td { 
            padding: 12px 16px; 
            text-align: left; 
        }

        th { 
            color: hsl(var(--muted-foreground)); 
            font-weight: 600;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid hsl(var(--border));
        }

        td {
            border-bottom: 1px solid hsl(var(--border));
            font-size: 0.9375rem;
        }

        tr:hover td {
            background: hsl(var(--muted) / 0.5);
        }

        /* Refresh Button */
        .refresh-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--primary-glow)));
            border: none;
            padding: 14px 24px;
            border-radius: calc(var(--radius) * 4);
            color: hsl(var(--primary-foreground));
            cursor: pointer;
            font-size: 0.9375rem;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .refresh-btn:hover { 
            transform: translateY(-2px) scale(1.02);
            box-shadow: var(--shadow-lg), 0 0 20px hsl(var(--primary) / 0.3);
        }

        /* Footer */
        .last-updated { 
            text-align: center; 
            color: hsl(var(--muted-foreground)); 
            margin-top: 32px; 
            font-size: 0.875rem;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { 
            background: hsl(var(--muted)); 
            border-radius: 4px; 
        }
        ::-webkit-scrollbar-thumb:hover { 
            background: hsl(var(--muted-foreground) / 0.3); 
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 16px; }
            h1 { font-size: 1.5rem; }
            .stat-card .value { font-size: 1.75rem; }
            .tables-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span class="logo">üìä</span>
                ALRIS ÏÇ¨Ïö©Îüâ ÎåÄÏãúÎ≥¥Îìú
            </h1>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">üåô</span>
                <span id="theme-text">Îã§ÌÅ¨ Î™®Îìú</span>
            </button>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">archilaw_v2 Ï¥ù ÏÇ¨Ïö©Îüâ</div>
                <div class="value" id="total-v1">-</div>
                <div class="trend" id="trend-v1">-</div>
            </div>
            <div class="stat-card">
                <div class="label">archilaw_v2 ÏµúÍ∑º 7Ïùº</div>
                <div class="value" id="week-v1">-</div>
            </div>
            <div class="stat-card v2">
                <div class="label">ALRIS V1 Ï¥ù ÏÇ¨Ïö©Îüâ</div>
                <div class="value" id="total-v2">-</div>
                <div class="trend" id="trend-v2">-</div>
            </div>
            <div class="stat-card v2">
                <div class="label">ALRIS V1 ÏµúÍ∑º 7Ïùº</div>
                <div class="value" id="week-v2">-</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">üìà ÏùºÎ≥Ñ ÏÇ¨Ïö©Îüâ Ï∂îÏù¥ (Ï†ÑÏ≤¥ Í∏∞Í∞Ñ)</div>
            <div class="chart-wrapper">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">üìä ÏµúÍ∑º 30Ïùº ÎπÑÍµê</div>
            <div class="chart-wrapper">
                <canvas id="recentChart"></canvas>
            </div>
        </div>

        <div class="tables-grid">
            <div class="table-container">
                <div class="chart-title">archilaw_v2 (qa_log) ÏµúÍ∑º Í∏∞Î°ù</div>
                <table id="table-v1">
                    <thead><tr><th>ÎÇ†Ïßú</th><th>Í±¥Ïàò</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="table-container">
                <div class="chart-title">ALRIS V1 ÏµúÍ∑º Í∏∞Î°ù</div>
                <table id="table-v2">
                    <thead><tr><th>ÎÇ†Ïßú</th><th>Í±¥Ïàò</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="last-updated" id="lastUpdated"></div>
    </div>

    <button class="refresh-btn" onclick="location.reload()">
        <span>üîÑ</span> ÏÉàÎ°úÍ≥†Ïπ®
    </button>

    <script>
        let chartMain, chartRecent;

        // Theme toggle
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeButton(isDark);
            updateChartColors();
        }

        function updateThemeButton(isDark) {
            document.getElementById('theme-icon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            document.getElementById('theme-text').textContent = isDark ? 'ÎùºÏù¥Ìä∏ Î™®Îìú' : 'Îã§ÌÅ¨ Î™®Îìú';
        }

        function getChartColors() {
            const isDark = document.documentElement.classList.contains('dark');
            return {
                v1: isDark ? 'hsl(197, 50%, 55%)' : 'hsl(197, 37%, 34%)',
                v1Bg: isDark ? 'hsla(197, 50%, 55%, 0.15)' : 'hsla(197, 37%, 34%, 0.1)',
                v2: isDark ? 'hsl(0, 84%, 65%)' : 'hsl(0, 84%, 60%)',
                v2Bg: isDark ? 'hsla(0, 84%, 65%, 0.15)' : 'hsla(0, 84%, 60%, 0.1)',
                grid: isDark ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.06)',
                text: isDark ? 'hsl(215, 20%, 65%)' : 'hsl(220, 9%, 46%)'
            };
        }

        function updateChartColors() {
            if (!chartMain || !chartRecent) return;
            const colors = getChartColors();
            
            // Update main chart
            chartMain.data.datasets[0].borderColor = colors.v1;
            chartMain.data.datasets[0].backgroundColor = colors.v1Bg;
            chartMain.data.datasets[1].borderColor = colors.v2;
            chartMain.data.datasets[1].backgroundColor = colors.v2Bg;
            chartMain.options.scales.x.ticks.color = colors.text;
            chartMain.options.scales.y.ticks.color = colors.text;
            chartMain.options.scales.x.grid.color = colors.grid;
            chartMain.options.scales.y.grid.color = colors.grid;
            chartMain.options.plugins.legend.labels.color = colors.text;
            chartMain.update();

            // Update recent chart
            chartRecent.data.datasets[0].backgroundColor = colors.v1;
            chartRecent.data.datasets[1].backgroundColor = colors.v2;
            chartRecent.options.scales.x.ticks.color = colors.text;
            chartRecent.options.scales.y.ticks.color = colors.text;
            chartRecent.options.scales.x.grid.color = colors.grid;
            chartRecent.options.scales.y.grid.color = colors.grid;
            chartRecent.options.plugins.legend.labels.color = colors.text;
            chartRecent.update();
        }

        // Initialize theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.classList.add('dark');
            updateThemeButton(true);
        }

        async function loadCSV(filename) {
            try {
                const response = await fetch(filename + '?t=' + Date.now());
                const text = await response.text();
                const lines = text.trim().split('\n').slice(1);
                return lines.map(line => {
                    const [date, count] = line.split(',');
                    return { date, count: parseInt(count) };
                });
            } catch (e) {
                console.error('Error loading', filename, e);
                return [];
            }
        }

        function calcStats(data) {
            const total = data.reduce((sum, d) => sum + d.count, 0);
            const last7 = data.slice(-7).reduce((sum, d) => sum + d.count, 0);
            const prev7 = data.slice(-14, -7).reduce((sum, d) => sum + d.count, 0);
            const startDate = data.length > 0 ? data[0].date : '-';
            return { total, last7, prev7, startDate, days: data.length };
        }

        function updateTable(tableId, data) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            tbody.innerHTML = data.slice(-20).reverse().map(d => 
                `<tr><td>${d.date}</td><td>${d.count.toLocaleString()}</td></tr>`
            ).join('');
        }

        function createCharts(dataV1, dataV2) {
            const ctx1 = document.getElementById('mainChart').getContext('2d');
            const ctx2 = document.getElementById('recentChart').getContext('2d');
            const colors = getChartColors();

            const allDates = [...new Set([...dataV1.map(d => d.date), ...dataV2.map(d => d.date)])].sort();
            const v1Map = Object.fromEntries(dataV1.map(d => [d.date, d.count]));
            const v2Map = Object.fromEntries(dataV2.map(d => [d.date, d.count]));

            chartMain = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: allDates,
                    datasets: [{
                        label: 'archilaw_v2',
                        data: allDates.map(d => v1Map[d] || 0),
                        borderColor: colors.v1,
                        backgroundColor: colors.v1Bg,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }, {
                        label: 'ALRIS V1',
                        data: allDates.map(d => v2Map[d] || 0),
                        borderColor: colors.v2,
                        backgroundColor: colors.v2Bg,
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { 
                        legend: { 
                            labels: { 
                                color: colors.text,
                                usePointStyle: true,
                                padding: 20
                            } 
                        } 
                    },
                    scales: {
                        x: { 
                            ticks: { color: colors.text, maxRotation: 0 }, 
                            grid: { color: colors.grid } 
                        },
                        y: { 
                            ticks: { color: colors.text }, 
                            grid: { color: colors.grid } 
                        }
                    }
                }
            });

            const recent30 = allDates.slice(-30);
            chartRecent = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: recent30,
                    datasets: [{
                        label: 'archilaw_v2',
                        data: recent30.map(d => v1Map[d] || 0),
                        backgroundColor: colors.v1,
                        borderRadius: 4
                    }, {
                        label: 'ALRIS V1',
                        data: recent30.map(d => v2Map[d] || 0),
                        backgroundColor: colors.v2,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            labels: { 
                                color: colors.text,
                                usePointStyle: true,
                                padding: 20
                            } 
                        } 
                    },
                    scales: {
                        x: { 
                            ticks: { color: colors.text, maxRotation: 45 }, 
                            grid: { color: colors.grid } 
                        },
                        y: { 
                            ticks: { color: colors.text }, 
                            grid: { color: colors.grid } 
                        }
                    }
                }
            });
        }

        async function init() {
            const [dataV1, dataV2] = await Promise.all([
                loadCSV('daily_usage.csv'),
                loadCSV('daily_usage_v2.csv')
            ]);

            const statsV1 = calcStats(dataV1);
            const statsV2 = calcStats(dataV2);

            document.getElementById('total-v1').textContent = statsV1.total.toLocaleString();
            document.getElementById('week-v1').textContent = statsV1.last7.toLocaleString();
            document.getElementById('total-v2').textContent = statsV2.total.toLocaleString();
            document.getElementById('week-v2').textContent = statsV2.last7.toLocaleString();

            document.getElementById('trend-v1').textContent = `${statsV1.startDate}Î∂ÄÌÑ∞ ${statsV1.days}ÏùºÍ∞Ñ`;
            document.getElementById('trend-v2').textContent = `${statsV2.startDate}Î∂ÄÌÑ∞ ${statsV2.days}ÏùºÍ∞Ñ`;

            updateTable('table-v1', dataV1);
            updateTable('table-v2', dataV2);

            createCharts(dataV1, dataV2);

            document.getElementById('lastUpdated').textContent = 
                'ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏: ' + new Date().toLocaleString('ko-KR');
        }

        init();
    </script>
</body>
</html>
